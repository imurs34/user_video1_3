<!DOCTYPE html>
<html>
  <head>
    <!-- <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    /> -->
    <!-- https://greensock.com/forums/topic/17657-draggable-resizable/?tab=comments#comment-80098 -->
    <!-- https://www.w3schools.com/cssref/tryit.asp?filename=trycss_position2 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/utils/Draggable.min.js"></script>
    <style>
      html, body {
        /* Screen becomes bigger because of strecth of image. Cannot use
             background-image: url("wood-bg.jpg");
            background-repeat: repeat;
             background-size: 100% 150%;
             */

        background-color: rgb(233, 199, 155);
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        height: 100%;
      }

      .slide-drag {
        display: block;
        position: relative;
        /* height: 200px;
            width: 200px; */
        background-color: #c80000;
        border-radius: 10px;
      }

      .green {
        background: green;
      }

      .bottomRight {
        display: none;
        position: absolute;
        height: 15px;
        width: 15px;
        background: gray;
        right: 0;
        bottom: 0;
      }

      .bottomLeft {
        display: none;
        position: absolute;
        height: 15px;
        width: 15px;
        background: gray;
        left: 0;
        bottom: 0;
      }

      .topLeft {
        display: none;
        position: absolute;
        height: 15px;
        width: 15px;
        background: gray;
        left: 0;
        top: 0;
      }

      .topRight {
        display: none;
        position: absolute;
        height: 15px;
        width: 15px;
        background: gray;
        right: 0;
        top: 0;
      }

      .top {
        display: none;
        position: absolute;
        height: 3px;
        width: 100%;
        background: none;
      }

      .left {
        display: none;
        position: absolute;
        height: 100%;
        width: 3px;
        background: none;
        left: 0;
      }

      .right {
        display: none;
        position: absolute;
        height: 100%;
        width: 3px;
        background: none;
        right: 0;
      }

      .bottom {
        display: none;
        position: absolute;
        height: 3px;
        width: 100%;
        background: none;
        /*was white */
        bottom: 0;
      }

      #audioFile {
        display: none;
      }

      #mySlider {
        width: 90%;
        margin-bottom: 2%;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        /* border: none; */
        height: 30px;
        width: 30px;
        /* border-radius: 50%; */
        /* background:url(images/image.jpg) center no-repeat; */
        /* margin-top: -24px; */
      }
      input[type="range"]:focus {
        outline: none;
      }

      #content {
        margin-left: auto;
        margin-right: auto;
        margin-top: 0%;
        /* width: 50%; */
        /* height: 500px; */
        /* width: 985px;
        height: 525px; */
        /* height: 350px;
        width: 300px; */
        height: 80%;
        width: 100%;

        /* min-width: 800px; */
        border: 3px solid #ff0;
        background-image: url("./image_resource/background.png");
        background-position: center;
        background-repeat: no-repeat;
        background-size: corver;
      }

      .loading {
        margin-top: 10%;
        margin-left: 50%;
      }

      .loader {
        border: 16px solid #f3f3f3;
        /* Light grey */
        border-top: 16px solid #3498db;
        /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 25px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: 0.2s;
        transition: opacity 0.2s;
      }

      .slider:hover {
        opacity: 1;
      }

      .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        background: #4caf50;
        cursor: pointer;
      }

      .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #4caf50;
        cursor: pointer;
      }

      #pText {
        position: absolute;
        top: 30%;
        left: 30%;
        color: green;
        font-size: 110%;
      }

      .slide,
      #content,
      .textSlide {
        display: none;
      }
      #buttonGroupText {
        font-size: 15px;
      }

      #buttonGroup,
      #val {
        margin: 0;
        padding: 0;
      }

      #val {
        display: inline;
        padding-left: 55%;
        padding-top: 5px;
      }

      .first {
        display: block;
      }

      #controls {
        position: fixed;
        left: 0;
        bottom: 5px;
        width: 100%;
        background-color: lightgray;
        border-radius: 20px;
        text-align: center;
      }

      button {
        border-radius: 10px;
        color: rgb(156, 115, 0);
      }

      .textSlide {
        background-color: rgb(121, 138, 150);
        color: white;
        font-size: 20px;
        font-family: sans-serif;
        border-radius: 8px;
        padding: 10px;
        touch-action: none;
        z-index: 1;
        width: 120px;
        height: 100px;
        position: absolute;
        overflow: hidden;
        text-overflow: clip;
        /* This makes things *much* easier */
        box-sizing: border-box;
      }

      .generalSlide {
        z-index: 0;
        background-size: 100% 100%;
        /* width: 500px; */
        /* height: 550px; */
        width: 200px;
        height: 200px;
        display: none;
        position: absolute;
      }

      .shadow {
        border: 3px solid #cacdca;
        filter: drop-shadow(8px 8px 10px yellow);
      }

      #header {
        background: #ddd;
        border-bottom: 1px solid #aaa;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
      }

      @media screen and (max-width: 767px) {
        .generalSlide {
          width: 100px;
          height: 100px;
          max-width: 100%;
        }

        .textSlide {
          width: 60px;
          height: 75px;
          font-size: 10px;
          max-width: 100%;
        }
        /* #content {
          width: 100%;
          min-width: auto;
        } */
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  </head>

  <body>
    <!-- <h1>Resize and Reposition text box and image</h1> -->

    <div class="loading">
      <h1>Content is loading...</h1>
      <div class="loader"></div>
    </div>

    <div id="content">
      <audio id="audioFile" controls preload="metadata">
        <source src="audio_user_video1_3.wav" type="audio/wav" />
        Your browser does not support the audio element.
      </audio>

      <div id="header">
        <span id="numbertext">1 / 11</span>
        <!-- <button onclick="resetSlide()">Reset</button> -->
      </div>
      <!-- <div class="resize-drag">
            Resize from any edge or corner
        </div> -->
      <!-- <div class="mySlides fade" id="container1">
            <div>Federalist vs. Anti-federalists</div>
            <img class="slide first" src="shot1.jpg">
            <div class="right1"></div>
            <div class="bottom1"></div>
            <div class="top1"></div>
            <div class="left1"></div>
            <div class="bottomRight1"></div>
            <div class="topLeft1"></div>
            <div class="topRight1"></div>
            <div class="bottomLeft1"></div>
        </div>  -->
      <!-- <div id="parent"> -->

      <!-- <div id="resize-drag1" >Federalist vs. Anti-federalists</div> -->
      <div id="dummy1"></div>
      <!-- </div> -->
      <div id="controls">
        <!-- <p style="display:inline" id="val" ></p> -->
        <div id="buttonGroup">
          <button id="buttonGroupText" onclick="beginClock()">‚ñ∂Ô∏è Start</button>
          <button id="buttonGroupText" onclick="stopClock()">‚è∏ Pause</button>
          <button id="buttonGroupText" onclick="resetSlide()">üîÑ Reset</button>
          <p id="val"></p>
          <!-- <button id="buttonGroupText" onclick="resetClock()">Reset</button> -->
        </div>
        <input
          type="range"
          min="0"
          max="120"
          value="0"
          id="mySlider"
          step=".2"
          onmousedown="stopClock()"
          oninput="showValue(this.value)"
          onchange="changeAudio(this.value)"
        />
        <!-- here -->
      </div>
    </div>

    <script>
      // const NUM_SECONDS_EACH_SLIDE = 20; // seconds for each slide
      var num = 0;
      var curContentIdx = 1;
      var startTime = 0;
      var durationIdx = 0;
      var contentData = [
        {

          slideNum: 1,
          defDuration: 20,
          duration: [],
          images: [
            {
              url: `./image_resource/slide1_img1.jpg`,
              style: `width: 960px; height: 440px;`,
              xy: [0, 0],
            }
          ],
          textContainers: [
          ],
        },
        {
          slideNum: 2,
          defDuration: 49,
          duration: [],
          images: [
            {
              url: `./image_resource/slide2_img1.png`,
              style: `width: 220px; height: 265px;`,
              xy: [80, 80],
            }
          ],
          textContainers: [
            {
              label: ` Summary of behavior of current loops in a magnetic field`,
              style: `font-size: 30.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 30em; height: 1.3em; font-weight: bold; font-style: italic;`,
              xy: [5.25, 10],
            },
            {
              label: `Oersted showed us that a current loop acts like an effective magnet.
The effective magnet is represented by a needle with a North and South pole as determined by our second right hand rule.`,
              style: `font-size: 28.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 20em; height: 6.8em;`,
              xy: [313, 78],
            },
          ],
        },
        {
          slideNum: 3,
          defDuration: 35,
          duration: [],
          images: [
            {
              url: `./image_resource/slide2_img1.png`,
              style: `width: 220px; height: 265px;`,
              xy: [80, 80],
            }
          ],
          textContainers: [
            {
              label: ` Summary of behavior of current loops in a magnetic field`,
              style: `font-size: 30.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 30em; height: 1.3em; font-weight: bold; font-style: italic;`,
              xy: [5.25, 10],
            },
            {
              label: `Curl the fingers of the right hand in the direction of the loop and the thumb points in the direction of the North pole.
While the current loop shares some properties of magnetic needles, its motion in a magnetic field is a bit different. It precesses instead of oscillating.`,
              style: `font-size: 28.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 20em; height: 8.5em;`,
              xy: [313, 78],
            },
          ],
        },
        {
          slideNum: 4,
          defDuration: 61,
          duration: [],
          images: [
            {
              url: `./image_resource/slide4_img1.png`,
              style: `width: 220px; height: 265px;`,
              xy: [80, 80],
            }
          ],
          textContainers: [
            {
              label: `  The motion we call precession`,
              style: `font-size: 30.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 30em; height: 1.3em; font-weight: bold; font-style: italic;`,
              xy: [5.25, 10],
            },
            {
              label: `Precession is a complex motion that is similar to oscillation, but different.
The effective needle traces out a circle and travels along the surface of a cone with the plane of the circle perpendicular to the direction of the magnetic field.`,
              style: `font-size: 28.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 20em; height: 6.8em;`,
              xy: [313, 78],
            },
          ],
        },
        {
          slideNum: 5,
          defDuration: 30,
          duration: [],
          images: [
            {
              url: `./image_resource/slide4_img1.png`,
              style: `width: 220px; height: 265px;`,
              xy: [80, 80],
            }
          ],
          textContainers: [
            {
              label: `  The motion we call precession`,
              style: `font-size: 30.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 30em; height: 1.3em; font-weight: bold; font-style: italic;`,
              xy: [5.25, 10],
            },
            {
              label: `The rate that the tip traces out the circle is proportional to the strength of the magnetic field.
The projection remains constant as a function of time.`,
              style: `font-size: 28.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 20em; height: 6.8em;`,
              xy: [313, 78],
            },
          ],
        },
        {
          slideNum: 6,
          defDuration: 33,
          duration: [],
          images: [
            {
              url: `./image_resource/slide6_img1.png`,
              style: `width: 350px; height: 265px;`,
              xy: [30, 80],
            }
          ],
          textContainers: [
            {
              label: ` In an inhomogeneous field, the current loop feels a push`,
              style: `font-size: 30.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 30em; height: 1.3em; font-weight: bold; font-style: italic;`,
              xy: [5.25, 10],
            },
            {
              label: `To determine the push or pull, we first draw the fat arrow for the inhomogeneous field and the effective needles for each current loop.`,
              style: `font-size: 28.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 15em; height: 6.8em;`,
              xy: [423, 78],
            },
          ],
        },
        {
          slideNum: 7,
          defDuration: 125,
          duration: [],
          images: [
            {
              url: `./image_resource/slide6_img1.png`,
              style: `width: 350px; height: 265px;`,
              xy: [30, 80],
            }
          ],
          textContainers: [
            {
              label: ` In an inhomogeneous field, the current loop feels a push`,
              style: `font-size: 30.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 30em; height: 1.3em; font-weight: bold; font-style: italic;`,
              xy: [5.25, 10],
            },
            {
              label: `The axis of increasing magnetic field is up as is the field, so we find the push is large and up, moderate and up, none, and large and down. Hence, the current loop will both precess and feel a push or pull in a nonuniform magnetic field.`,
              style: `font-size: 28.5px; font-family: Arial; color: #000000; background: #FFFFFF; width: 17em; height: 8.2em;`,
              xy: [423, 78],
            },
          ],
        },


      ];
      var text = [
        "My Header!",
        "My Other Header",
        "Something I liked to write! ",
      ];
      var audioFile = document.getElementById("audioFile");
      var mySlider = document.getElementById("mySlider");

      $(".loading").hide(2000, function () {
        //audioFile.play();
        resetSlider();
        $("#content").fadeIn();
        // $("#mySlider").attr("max", audioFile.duration);
        $("#mySlider").attr("max", 353);
      });

      var index = 0;

      for (let i = 1; i <= contentData.length; i++) {
        for (
          let tIdx = 0;
          tIdx < contentData[i - 1].textContainers.length;
          tIdx++
        ) {
          $(`#dummy${i}`).before(
            `<div id="resize-drag${i}-${tIdx + 1}" class="textSlide" style="${
              contentData[i - 1].textContainers[tIdx].style
            }">${contentData[i - 1].textContainers[tIdx].label}</div>`
          );
          if (i === 1) {
            $(`#resize-drag1-${tIdx + 1}`).css("display", "block");
          }
        }

        for (let j = 0; j < contentData[i - 1].images.length; j++) {
          let parentId = "";
          if (j === 0) {
            parentId = `#dummy${i}`;
          } else {
            parentId = `#container${i}-${j}`;
          }
          $(parentId)
            .before(`<div class='fade slide generalSlide' id='container${i}-${
            j + 1
          }' style="${contentData[i - 1].images[j].style}">
                  <div class='right'></div>
                  <div class='bottom'></div>
                  <div class='top'></div>
                  <div class='left'></div>
                  <div class='bottomRight'></div>
                  <div class='topLeft'></div>
                  <div class='topRight'></div>
                  <div class='bottomLeft'></div>
                      </div>`);

          $(`#container${i}-${j + 1}`).css(
            "background-image",
            `url("${contentData[i - 1].images[j].url}")`
          );
          $(`#container${i}-${j + 1}`).css("z-index", 0);

          $(`#container${i}-${j + 1}`).data("imgIdx", j);
        }
        $(`#dummy${i}`).after(`<div id="dummy${i + 1}"></div>`);
      }

      mySlider.addEventListener("mouseup", beginClock);

      audioFile.onended = function () {
        resetClock();
      };

      function log(arrOfValues) {
        arrOfValues.forEach((x) => console.log(x));
      }

      /**
       * is called when on change... means that it is called when the user lets go of the slider.
       */
      function changeAudio(timeInTrack) {
        stopClock();
        setCurTime(timeInTrack); // changes time of file
      }

      function showValue(val) {
        //document.querySelector("#audioFile").play();

        const floored = Math.floor(val);
        // var imageNum = Math.floor(
        //   (floored / NUM_SECONDS_EACH_SLIDE) % images.length
        // );
        // log([imageNum]);
        let isFindCurIdx = false;
        let curIdx = curContentIdx - 1;
        while (!isFindCurIdx) {
          curIdx = curContentIdx - 1;
          let duration = contentData[curIdx].duration[durationIdx]
            ? contentData[curIdx].duration[durationIdx]
            : contentData[curIdx].defDuration;
          const endTime = startTime + duration;
          if (val >= endTime && contentData[curIdx + 1]) {
            startTime = endTime;
            curContentIdx += 1;
          } else if (val < startTime && contentData[curIdx - 1]) {
            duration = contentData[curIdx - 1].duration[durationIdx]
              ? contentData[curIdx - 1].duration[durationIdx]
              : contentData[curIdx - 1].defDuration;
            startTime -= duration;
            curContentIdx -= 1;
          } else if (val >= endTime && !contentData[curIdx + 1]) {
            startTime = endTime;
            curContentIdx = 1;
            durationIdx += 1;
          } else if (val < startTime && !contentData[curIdx - 1]) {
            durationIdx -= 1;
            duration = contentData[contentData.length - 1].duration[durationIdx]
              ? contentData[contentData.length - 1].duration[durationIdx]
              : contentData[contentData.length - 1].defDuration;
            startTime -= duration;
            curContentIdx = contentData.length;
          } else {
            isFindCurIdx = true;
          }

          // console.log(
          //   val,
          //   curContentIdx,
          //   "durationIdx - " + durationIdx,
          //   "duration - " + contentData[curIdx].duration,
          //   "sTime - " + startTime,
          //   "eTime - " + endTime
          // );
        }

        let hour = parseInt(floored / 60);
        let minute = floored % 60;
        minute = minute == 0 || minute < 10 ? "0" + minute : minute;
        document.querySelector("#val").innerHTML = `${hour}:${minute}`;

        $("#numbertext").text(curContentIdx + " / " + contentData.length);

        let regExp = new RegExp(`container${curContentIdx}`, "i");

        for (let i = 1; i <= contentData.length; i++) {
          if (curContentIdx === i) {
            displayImages(curContentIdx, "block");
            displayTextContainer(curContentIdx, "block");
            initImageSize(curContentIdx);
            initTextPosition(curContentIdx);
          } else {
            displayImages(i, "none");
            displayTextContainer(i, "none");
          }
        }
        $("#pText").css("top", `${(curContentIdx + 1) * 10}%`);
        $("#pText").css("left", `${curContentIdx * 10}%`);
      }

      var startClock;
      var hasStarted = false;

      function stopClock() {
        audioFile.pause();
        hasStarted = false;
        clearInterval(startClock);
      }

      function resetClock() {
        resetSlider();
        stopClock();
        beginClock();
      }

      function resetSlider() {
        document.querySelector("#mySlider").value = 0;
        setCurTime(0);
      }

      function beginClock() {
        log(["playing"]);

        if (hasStarted == false) {
          audioFile.play();
          startClock = setInterval(function () {
            var val =
              parseFloat(document.querySelector("#mySlider").value) + 0.2;
            //document.querySelector("#val").innerHTML = val.toFixed(0);
            document.querySelector("#mySlider").value = val;
            //log([val]);
            showValue(val);
          }, 200);
          hasStarted = true;
        }
      }

      function setCurTime(time) {
        // log([time]);
        audioFile.currentTime = time;
      }

      //var $container = document.getElementsByClassName('slide');

      function dragMoveListener(event) {
        var target = event.target;
        // keep the dragged position in the data-x/data-y attributes
        var x = (parseFloat(target.getAttribute("data-x")) || 0) + event.dx;
        var y = (parseFloat(target.getAttribute("data-y")) || 0) + event.dy;
        $(target.id).addClass("shadow");

        // translate the element
        target.style.webkitTransform = target.style.transform =
          "translate(" + x + "px, " + y + "px)";

        // update the posiion attributes
        target.setAttribute("data-x", x);
        target.setAttribute("data-y", y);
      }

      var containerArrays = [];
      var curImgIdx = undefined;
      var maxTextSizeHeight = 400;
      var maxTextSizeWidth = 500;
      var minTextSizeHeight = 100;
      var minTextSizeWidth = 120;
      var textSizeY = 0.3;
      var rowPerImage = 3;
      var rowPerText = 4;
      var imageSpacing = 40;
      var textSpacing = 40;
      var selectedZIndex = 1;
      var curTargetId = "";
      if (window.matchMedia("(max-width: 767px)").matches) {
        // The viewport is less than 768 pixels wide
        //document.write("This is a mobile device.");
        maxTextSizeHeight = maxTextSizeHeight / 2;
        maxTextSizeWidth = maxTextSizeWidth / 2;
        minTextSizeHeight = minTextSizeHeight / 2;
        minTextSizeWidth = minTextSizeWidth / 2;
        textSizeY = 0.23;
        imageSpacing = 20;
        textSpacing = 30;
      } //else {
      // The viewport is at least 768 pixels wide
      // document.write("This is a tablet or desktop.");
      // }

      // Interact JS
      var textLeftLastX = [];
      var textRightLastX = [];
      var textBottomLastY = [];
      var textTopLastY = [];

      // this function is used later in the resizing and gesture demos
      window.dragMoveListener = dragMoveListener;

      var initSlideData = [];

      /*
            2020-07-12 added codes
            */
      function displayTextContainer(idx, val) {
        if (idx < 1) {
          return;
        }
        for (let i = 0; i < contentData[idx - 1].textContainers.length; i++) {
          $(`#resize-drag${idx}-${i + 1}`).css("display", val);
        }
      }

      function displayImages(idx, val) {
        if (idx < 1) {
          return;
        }
        for (
          let imgIdx = 0;
          imgIdx < contentData[idx - 1].images.length;
          imgIdx++
        ) {
          $(`#container${idx}-${imgIdx + 1}`).css("display", val);
          $(".right", `#container${idx}-${imgIdx + 1}`).css("display", val);
          $(".left", `#container${idx}-${imgIdx + 1}`).css("display", val);
          $(".bottom", `#container${idx}-${imgIdx + 1}`).css("display", val);
          $(".top", `#container${idx}-${imgIdx + 1}`).css("display", val);
          $(".bottomRight", `#container${idx}-${imgIdx + 1}`).css(
            "display",
            val
          );
          $(".topRight", `#container${idx}-${imgIdx + 1}`).css("display", val);
          $(".bottomLeft", `#container${idx}-${imgIdx + 1}`).css(
            "display",
            val
          );
          $(".topLeft", `#container${idx}-${imgIdx + 1}`).css("display", val);

          if (val === "block" && !initSlideData[idx - 1].imageData[imgIdx]) {
            initSlideData[idx - 1].imageData[imgIdx] = {
              width: $(`#container${idx}-${imgIdx + 1}`).outerWidth(),
              height: $(`#container${idx}-${imgIdx + 1}`).outerHeight(),
            };

            if (
              contentData[idx - 1].images[imgIdx].xy &&
              contentData[idx - 1].images[imgIdx].xy.length
            ) {
              initSlideData[idx - 1].imageData[imgIdx].xy =
                contentData[idx - 1].images[imgIdx].xy;
            }
          }
        }
      }

      function calcTextSizeY(area, defFontSizeVal, isPlus) {
        let y = parseFloat(textSizeY);
        let isWhile = true;
        while (isWhile) {
          const val = Math.pow(parseFloat(area), y);
          if (isPlus) {
            if (val >= defFontSizeVal) {
              isWhile = false;
            } else {
              // y += 0.01;
              y *= 1.00001;
            }
          } else {
            if (val <= defFontSizeVal) {
              isWhile = false;
            } else {
              // y -= 0.01;
              y /= 1.00001;
            }
          }
        }
        return y;
      }

      function initTextPosition(idx) {
        if (idx < 1) {
          return;
        }

        if (initSlideData[idx - 1] && initSlideData[idx - 1].isInitText) {
          initSlideData[idx - 1].isInitText = false;

          const timer = setInterval(function () {
            if (
              $(
                `#resize-drag${idx}-${
                  contentData[idx - 1].textContainers.length
                }`
              ).offset().top
            ) {
              clearInterval(timer);
              let cnt = 0;
              let usedWidth = 0;
              for (
                let i = 0;
                i < contentData[idx - 1].textContainers.length;
                i++
              ) {
                if (!initSlideData[idx - 1].textContainerData[i]) {
                  let defWidth = $(`#resize-drag${idx}-${i + 1}`).outerWidth();
                  let defHeight = $(
                    `#resize-drag${idx}-${i + 1}`
                  ).outerHeight();
                  let defFontSize = $(`#resize-drag${idx}-${i + 1}`).css(
                    "font-size"
                  );
                  const area = parseFloat(defWidth) * parseFloat(defHeight);
                  const fontSizeVal = Math.pow(parseFloat(area), textSizeY);
                  const defFontSizeVal = parseFloat(
                    defFontSize.replace("px", "")
                  );

                  let powY;
                  if (fontSizeVal > defFontSizeVal) {
                    powY = calcTextSizeY(area, defFontSizeVal, false);
                  } else {
                    powY = calcTextSizeY(area, defFontSizeVal, true);
                  }

                  initSlideData[idx - 1].textContainerData[i] = {
                    width: defWidth,
                    height: defHeight,
                    fontSize: defFontSize,
                    powY: powY,
                  };
                  if (
                    contentData[idx - 1].textContainers[i].xy &&
                    contentData[idx - 1].textContainers[i].xy.length
                  ) {
                    initSlideData[idx - 1].textContainerData[i].xy =
                      contentData[idx - 1].textContainers[i].xy;
                  }
                }

                if (i > 0) {
                  const totalWidth =
                    usedWidth + $(`#resize-drag${idx}-${i + 1}`).outerWidth();
                  if (totalWidth >= $(`#content`).outerWidth()) {
                    const x = $(`#resize-drag${idx}-${i - cnt}`).offset().left;
                    const y =
                      $(`#resize-drag${idx}-${i}`).offset().top +
                      $(`#resize-drag${idx}-${i}`).height() +
                      textSpacing;
                    $(`#resize-drag${idx}-${i + 1}`).offset({
                      top: y,
                      left: x,
                    });
                    usedWidth = 0;
                  } else {
                    const x =
                      $(`#resize-drag${idx}-${i}`).offset().left +
                      $(`#resize-drag${idx}-${i}`).width() +
                      textSpacing;
                    const y = $(`#resize-drag${idx}-${i}`).offset().top;
                    $(`#resize-drag${idx}-${i + 1}`).offset({
                      top: y,
                      left: x,
                    });
                  }
                  cnt++;
                } else {
                  const x = $(`#content`).offset().left;
                  const y =
                    $(`#header`).offset().top + $(`#header`).height() + 10;
                  $(`#resize-drag${idx}-${i + 1}`).offset({
                    top: y,
                    left: x,
                  });
                }

                // if (i > 0) {
                //   if (i % rowPerText === 0) {
                //     const x = $(`#resize-drag${idx}-${i - cnt}`).offset().left;
                //     const y =
                //       $(`#resize-drag${idx}-${i}`).offset().top +
                //       $(`#resize-drag${idx}-${i}`).height() +
                //       textSpacing;
                //     $(`#resize-drag${idx}-${i + 1}`).offset({
                //       top: y,
                //       left: x,
                //     });
                //   } else {
                //     const x =
                //       $(`#resize-drag${idx}-${i}`).offset().left +
                //       $(`#resize-drag${idx}-${i}`).width() +
                //       textSpacing;
                //     const y = $(`#resize-drag${idx}-${i}`).offset().top;
                //     $(`#resize-drag${idx}-${i + 1}`).offset({
                //       top: y,
                //       left: x,
                //     });
                //   }
                //   cnt++;
                // } else {
                //   const x = $(`#content`).offset().left;
                //   const y =
                //     $(`#header`).offset().top + $(`#header`).height() + 10;
                //   $(`#resize-drag${idx}-${i + 1}`).offset({
                //     top: y,
                //     left: x,
                //   });
                // }

                $(`#resize-drag${idx}-${i + 1}`).width(
                  initSlideData[idx - 1].textContainerData[i].width
                );
                $(`#resize-drag${idx}-${i + 1}`).height(
                  initSlideData[idx - 1].textContainerData[i].height
                );
                $(
                  `#resize-drag${idx}-${i + 1}, #resize-drag${idx}-${i + 1} *`
                ).css(
                  "font-size",
                  initSlideData[idx - 1].textContainerData[i].fontSize
                );
                if (initSlideData[idx - 1].textContainerData[i].xy) {
                  const x =
                    $(`#content`).offset().left +
                    initSlideData[idx - 1].textContainerData[i].xy[0];
                  const y =
                    $(`#header`).offset().top +
                    $(`#header`).height() +
                    10 +
                    initSlideData[idx - 1].textContainerData[i].xy[1];
                  $(`#resize-drag${idx}-${i + 1}`).offset({
                    left: x,
                    top: y,
                  });
                  usedWidth = 0;
                }

                usedWidth += $(`#resize-drag${idx}-${i + 1}`).outerWidth();
              }
            }
          }, 10);
        }
      }

      function initImageSize(idx) {
        if (initSlideData[idx - 1].isInitImage) {
          initSlideData[idx - 1].isInitImage = false;

          if (
            contentData[idx - 1].images &&
            contentData[idx - 1].images.length
          ) {
            const timer = setInterval(function () {
              if (
                $(
                  `#container${idx}-${contentData[idx - 1].images.length}`
                ).offset().top
              ) {
                clearInterval(timer);
                let cnt = 0;
                let usedWidth = 0;
                for (
                  let imgIdx = 0;
                  imgIdx < contentData[idx - 1].images.length;
                  imgIdx++
                ) {
                  if (imgIdx > 0) {
                    const totalWidth =
                      usedWidth +
                      $(`#container${idx}-${imgIdx + 1}`).outerWidth();
                    if (totalWidth >= $(`#content`).outerWidth()) {
                      const x = $(`#container${idx}-${imgIdx - cnt}`).offset()
                        .left;
                      const y =
                        $(`#container${idx}-${imgIdx}`).offset().top +
                        $(`#container${idx}-${imgIdx}`).height() +
                        imageSpacing;
                      $(`#container${idx}-${imgIdx + 1}`).offset({
                        top: y,
                        left: x,
                      });
                      usedWidth = 0;
                    } else {
                      const x =
                        $(`#container${idx}-${imgIdx}`).offset().left +
                        $(`#container${idx}-${imgIdx}`).width() +
                        imageSpacing;
                      const y = $(`#container${idx}-${imgIdx}`).offset().top;
                      $(`#container${idx}-${imgIdx + 1}`).offset({
                        top: y,
                        left: x,
                      });
                    }
                    cnt++;
                  } else {
                    const x = $(`#content`).offset().left;
                    const y =
                      $(`#header`).offset().top + $(`#header`).height() + 10;
                    $(`#container${idx}-${imgIdx + 1}`).offset({
                      top: y,
                      left: x,
                    });
                  }
                  // if (imgIdx > 0) {
                  //   if (imgIdx % rowPerImage === 0) {
                  //     const x = $(`#container${idx}-${imgIdx - cnt}`).offset()
                  //       .left;
                  //     const y =
                  //       $(`#container${idx}-${imgIdx}`).offset().top +
                  //       $(`#container${idx}-${imgIdx}`).height() +
                  //       imageSpacing;
                  //     $(`#container${idx}-${imgIdx + 1}`).offset({
                  //       top: y,
                  //       left: x,
                  //     });
                  //   } else {
                  //     const x =
                  //       $(`#container${idx}-${imgIdx}`).offset().left +
                  //       $(`#container${idx}-${imgIdx}`).width() +
                  //       imageSpacing;
                  //     const y = $(`#container${idx}-${imgIdx}`).offset().top;
                  //     $(`#container${idx}-${imgIdx + 1}`).offset({
                  //       top: y,
                  //       left: x,
                  //     });
                  //   }
                  //   cnt++;
                  // } else {
                  //   const x = $(`#content`).offset().left;
                  //   const y =
                  //     $(`#header`).offset().top + $(`#header`).height() + 10;
                  //   $(`#container${idx}-${imgIdx + 1}`).offset({
                  //     top: y,
                  //     left: x,
                  //   });
                  // }

                  $(`#container${idx}-${imgIdx + 1}`).width(
                    initSlideData[idx - 1].imageData[imgIdx].width
                  );
                  $(`#container${idx}-${imgIdx + 1}`).height(
                    initSlideData[idx - 1].imageData[imgIdx].height
                  );
                  $(`#container${idx}-${imgIdx + 1}`).css("z-index", 0);
                  if (initSlideData[idx - 1].imageData[imgIdx].xy) {
                    const x =
                      $(`#content`).offset().left +
                      initSlideData[idx - 1].imageData[imgIdx].xy[0];
                    const y =
                      $(`#header`).offset().top +
                      $(`#header`).height() +
                      10 +
                      initSlideData[idx - 1].imageData[imgIdx].xy[1];
                    $(`#container${idx}-${imgIdx + 1}`).offset({
                      left: x,
                      top: y,
                    });
                    usedWidth = 0;
                  }

                  usedWidth += $(`#container${idx}-${imgIdx + 1}`).outerWidth();
                }
              }
            }, 10);
          }
        }
      }

      function resetSlide() {
        initSlideData[curContentIdx - 1].isInitText = true;
        initSlideData[curContentIdx - 1].isInitImage = true;
        initTextPosition(curContentIdx);
        initImageSize(curContentIdx);
      }

      function setImageEvent(x) {
        containerArrays[x - 1] = [];

        for (let i = 0; i < contentData[x - 1].images.length; i++) {
          let $container = document.getElementById(`container${x}-${i + 1}`);
          if ($container) {
            let instantObj = {};
            instantObj.leftLastX = 0;
            instantObj.rightLastX = 0;
            instantObj.bottomLastY = 0;
            instantObj.topLastY = 0;

            instantObj.$container = $container;
            //Proxies
            let $right = document.createElement("div");
            let $bottom = document.createElement("div");
            let $top = document.createElement("div");
            let $left = document.createElement("div");
            instantObj.$right = $right;
            instantObj.$left = $left;
            instantObj.$top = $top;
            instantObj.$bottom = $bottom;

            let mainDraggable = new Draggable(instantObj.$container, {
              bounds: "#content",
              inertia: true,
              edgeResistance: 0.65,
              onDrag: function (e) {
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onPress: function (e) {
                curImgIdx = parseInt($(`#${e.target.id}`).data("imgIdx"));
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].rightDraggable.disable();
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].bottomDraggable.disable();
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].topDraggable.disable();
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].leftDraggable.disable();

                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onRelease: function (e) {
                if (!isNaN(curImgIdx)) {
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].rightDraggable.enable();
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].bottomDraggable.enable();
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].topDraggable.enable();
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].leftDraggable.enable();

                  // $(`#container${curContentIdx}-${curImgIdx + 1}`).removeClass(
                  //   "shadow"
                  // );
                  selectedZIndex++;
                  $(`#container${curContentIdx}-${curImgIdx + 1}`).css(
                    "z-index",
                    selectedZIndex
                  );
                  curImgIdx = undefined;
                }
              },
            });
            instantObj.mainDraggable = mainDraggable;

            let rightDraggable = new Draggable(instantObj.$right, {
              trigger: `.right, .topRight, .bottomRight`,
              cursor: "e-resize",
              onDrag: function (e) {
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  let diffX =
                    this.x -
                    containerArrays[curContentIdx - 1][curImgIdx].rightLastX;
                  //console.log(`Image Num: ${curContentIdx} updateRight  onDrag rightLastX`, rightLastX[curContentIdx - 1]);
                  const curWidth = $(
                    containerArrays[curContentIdx - 1][curImgIdx].$container
                  ).width();
                  if ($("#content").width() > curWidth || diffX < 0) {
                    TweenMax.set(
                      containerArrays[curContentIdx - 1][curImgIdx].$container,
                      {
                        width: "+=" + diffX,
                      }
                    );
                    containerArrays[curContentIdx - 1][
                      curImgIdx
                    ].rightLastX = this.x;
                  }

                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onPress: function (e) {
                curImgIdx = parseInt($(e.target).parent().data("imgIdx"));
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].rightLastX = this.x;
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.disable();
                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onRelease: function (e) {
                if (!isNaN(curImgIdx)) {
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.enable();
                  // $(`#container${curContentIdx}-${curImgIdx + 1}`).removeClass(
                  //   "shadow"
                  // );
                  curImgIdx = undefined;
                }
              },
            });

            let bottomDraggable = new Draggable(instantObj.$bottom, {
              trigger: `.bottom, .bottomRight, .bottomLeft`,
              cursor: "s-resize",
              onDrag: function (e) {
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  let diffY =
                    this.y -
                    containerArrays[curContentIdx - 1][curImgIdx].bottomLastY;
                  //console.log(`Image Num: ${curContentIdx} updateBottom  onDrag bottomLastY`, bottomLastY[curContentIdx - 1]);

                  const curHeight = $(
                    containerArrays[curContentIdx - 1][curImgIdx].$container
                  ).height();
                  if ($("#content").height() > curHeight || diffY < 0) {
                    TweenMax.set(
                      containerArrays[curContentIdx - 1][curImgIdx].$container,
                      {
                        height: "+=" + diffY,
                      }
                    );
                    containerArrays[curContentIdx - 1][
                      curImgIdx
                    ].bottomLastY = this.y;
                  }

                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onPress: function (e) {
                curImgIdx = parseInt($(e.target).parent().data("imgIdx"));
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].bottomLastY = this.y;
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.disable();
                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onRelease: function (e) {
                if (!isNaN(curImgIdx)) {
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.enable();
                  // $(`#container${curContentIdx}-${curImgIdx + 1}`).removeClass(
                  //   "shadow"
                  // );
                  curImgIdx = undefined;
                }
              },
            });

            let topDraggable = new Draggable(instantObj.$top, {
              trigger: `.top, .topRight, .topLeft`,
              cursor: "n-resize",
              onDrag: function (e) {
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  let diffY =
                    this.y -
                    containerArrays[curContentIdx - 1][curImgIdx].topLastY;

                  const curHeight = $(
                    containerArrays[curContentIdx - 1][curImgIdx].$container
                  ).height();
                  if ($("#content").height() > curHeight || diffY < 0) {
                    TweenMax.set(
                      containerArrays[curContentIdx - 1][curImgIdx].$container,
                      {
                        height: "-=" + diffY,
                        y: "+=" + diffY,
                      }
                    );
                    containerArrays[curContentIdx - 1][
                      curImgIdx
                    ].topLastY = this.y;
                  }

                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onPress: function (e) {
                curImgIdx = parseInt($(e.target).parent().data("imgIdx"));
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].topLastY = this.y;
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.disable();
                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onRelease: function (e) {
                if (!isNaN(curImgIdx)) {
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.enable();
                  // $(`#container${curContentIdx}-${curImgIdx + 1}`).removeClass(
                  //   "shadow"
                  // );
                  curImgIdx = undefined;
                }
              },
            });

            let leftDraggable = new Draggable(instantObj.$left, {
              trigger: `.left, .topLeft, .bottomLeft`,
              cursor: "w-resize",
              onDrag: function (e) {
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  let diffX =
                    this.x -
                    containerArrays[curContentIdx - 1][curImgIdx].leftLastX;

                  const curWidth = $(
                    containerArrays[curContentIdx - 1][curImgIdx].$container
                  ).width();
                  if ($("#content").width() > curWidth || diffX < 0) {
                    TweenMax.set(
                      containerArrays[curContentIdx - 1][curImgIdx].$container,
                      {
                        width: "-=" + diffX,
                        x: "+=" + diffX,
                      }
                    );
                    containerArrays[curContentIdx - 1][
                      curImgIdx
                    ].leftLastX = this.x;
                  }

                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onPress: function (e) {
                curImgIdx = parseInt($(e.target).parent().data("imgIdx"));
                if (!isNaN(curImgIdx)) {
                  $(".slide").removeClass("shadow");
                  $(".textSlide").removeClass("shadow");
                  // console.log(`Image Num: ${curContentIdx} leftDrag  onPress`, this.x);
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].leftLastX = this.x;
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.disable();
                  $(`#container${curContentIdx}-${curImgIdx + 1}`).addClass(
                    "shadow"
                  );
                }
              },
              onRelease: function (e) {
                if (!isNaN(curImgIdx)) {
                  containerArrays[curContentIdx - 1][
                    curImgIdx
                  ].mainDraggable.enable();
                  // $(`#container${curContentIdx}-${curImgIdx + 1}`).removeClass(
                  //   "shadow"
                  // );
                  curImgIdx = undefined;
                }
              },
            });

            instantObj.rightDraggable = rightDraggable;
            instantObj.bottomDraggable = bottomDraggable;
            instantObj.topDraggable = topDraggable;
            instantObj.leftDraggable = leftDraggable;
            containerArrays[x - 1].push(instantObj);
          }
        }
      }

      var curRectWidth = 0;
      var curRectHeight = 0;
      function setTextEvent(p) {
        initSlideData[p - 1] = {
          isInitText: true,
          isInitImage: true,
          textContainerData: [],
          imageData: [],
        };
        for (let i = 0; i < contentData[p - 1].textContainers.length; i++) {
          $(`#resize-drag${p}-${i + 1}`).click(function () {
            // $(this).removeClass("shadow");
            console.log("mouseup");
          });

          interact(`#resize-drag${p}-${i + 1}`)
            // .on("hold", function (e) {
            //   let target = e.target;
            //   if (!target.id) {
            //     target = $(e.target).parents(".textSlide")[0];
            //   }
            //   const idx = parseInt(target.id.substring(target.id.length - 1));
            //   $(`#resize-drag${curContentIdx}-${idx}`).addClass("shadow");
            //   selectedZIndex++;
            //   $(`#resize-drag${curContentIdx}-${idx}`).css(
            //     "z-index",
            //     selectedZIndex
            //   );
            // })
            .on("mousedown", function (e) {
              $(".textSlide").removeClass("shadow");
              $(".slide").removeClass("shadow");
              let target = e.target;
              if (!target.id) {
                target = $(e.target).parents(".textSlide")[0];
              }
              curTargetId = target.id;
              const idx = parseInt(target.id.substring(target.id.length - 1));
              $(`#resize-drag${curContentIdx}-${idx}`).addClass("shadow");
              selectedZIndex++;
              $(`#resize-drag${curContentIdx}-${idx}`).css(
                "z-index",
                selectedZIndex
              );
            })
            .on("touchstart", function (e) {
              $(".textSlide").removeClass("shadow");
              $(".slide").removeClass("shadow");
              let target = e.target;
              if (!target.id) {
                target = $(e.target).parents(".textSlide")[0];
              }
              curTargetId = target.id;
              const idx = parseInt(target.id.substring(target.id.length - 1));
              $(`#resize-drag${curContentIdx}-${idx}`).addClass("shadow");
              selectedZIndex++;
              $(`#resize-drag${curContentIdx}-${idx}`).css(
                "z-index",
                selectedZIndex
              );
            })
            .on("dragstart", function (e) {
              $(".textSlide").removeClass("shadow");
              $(".slide").removeClass("shadow");
              let target = e.target;
              if (!target.id) {
                target = $(e.target).parents(".textSlide")[0];
              }
              curTargetId = target.id;
              const idx = parseInt(target.id.substring(target.id.length - 1));
              $(`#resize-drag${curContentIdx}-${idx}`).addClass("shadow");
              selectedZIndex++;
              $(`#resize-drag${curContentIdx}-${idx}`).css(
                "z-index",
                selectedZIndex
              );
            })
            // .on("dragend", function (e) {
            //   let target = e.target;
            //   if (!target.id) {
            //     target = $(e.target).parents(".textSlide")[0];
            //   }
            //   const idx = parseInt(target.id.substring(target.id.length - 1));
            // })
            // .on("mouseup", function (e) {
            //   let target = e.target;
            //   if (!target.id) {
            //     target = $(e.target).parents(".textSlide")[0];
            //   }
            //   const idx = parseInt(target.id.substring(target.id.length - 1));
            // })
            // .on("touchend", function (e) {
            //   let target = e.target;
            //   if (!target.id) {
            //     target = $(e.target).parents(".textSlide")[0];
            //   }
            //   const idx = parseInt(target.id.substring(target.id.length - 1));
            // })
            .resizable({
              // resize from all edges and corners
              edges: { left: true, right: true, bottom: true, top: true },

              listeners: {
                move(event) {
                  $(".textSlide").removeClass("shadow");
                  $(".slide").removeClass("shadow");
                  const target = event.target;
                  if (!target.id) {
                    target = $(e.target).parents(".textSlide")[0];
                  }
                  const idx = parseInt(
                    target.id.substring(target.id.length - 1)
                  );
                  curTargetId = target.id;
                  $(`#resize-drag${curContentIdx}-${idx}`).addClass("shadow");

                  var x = parseFloat(target.getAttribute("data-x")) || 0;
                  var y = parseFloat(target.getAttribute("data-y")) || 0;

                  curRectWidth = parseFloat(
                    target.style.width.replace("px", "")
                  );
                  curRectHeight = parseFloat(
                    target.style.height.replace("px", "")
                  );
                  // update the element's style
                  target.style.width = event.rect.width + "px";
                  target.style.height = event.rect.height + "px";

                  if (
                    initSlideData[curContentIdx - 1].textContainerData[
                      idx - 1
                    ] &&
                    initSlideData[curContentIdx - 1].textContainerData[idx - 1]
                      .fontSize
                  ) {
                    const area =
                      parseFloat(event.rect.height) *
                      parseFloat(event.rect.width);
                    const newSize = Math.pow(
                      parseFloat(area),
                      initSlideData[curContentIdx - 1].textContainerData[
                        idx - 1
                      ].powY
                    );
                    const defFontSize = parseInt(
                      initSlideData[curContentIdx - 1].textContainerData[
                        idx - 1
                      ].fontSize.replace("px", "")
                    );
                    if (newSize > defFontSize) {
                      $(
                        `#resize-drag${curContentIdx}-${idx}, #resize-drag${curContentIdx}-${idx} *`
                      ).css("font-size", `${newSize}px`);
                    }
                  }

                  // translate when resizing from top or left edges
                  x += event.deltaRect.left;
                  y += event.deltaRect.top;

                  target.style.webkitTransform = target.style.transform =
                    "translate(" + x + "px," + y + "px)";

                  target.setAttribute("data-x", x);
                  target.setAttribute("data-y", y);

                  // target.textContent = Math.round(event.rect.width) + '\u00D7' + Math.round(event.rect.height)
                },
                end(event) {
                  const target = event.target;
                  if (!target.id) {
                    target = $(e.target).parents(".textSlide")[0];
                  }
                  curTargetId = target.id;
                  const idx = parseInt(
                    target.id.substring(target.id.length - 1)
                  );
                  // $(`#resize-drag${curContentIdx}-${idx}`).removeClass(
                  //   "shadow"
                  // );
                  selectedZIndex++;
                  $(`#resize-drag${curContentIdx}-${idx}`).css(
                    "z-index",
                    selectedZIndex
                  );
                },
              },
              modifiers: [
                // keep the edges inside the parent
                interact.modifiers.restrictEdges({
                  outer: "parent",
                }),

                // minimum size and max size
                interact.modifiers.restrictSize({
                  // min: { width: minTextSizeWidth, height: minTextSizeHeight },
                  // max: { width: maxTextSizeWidth, height: maxTextSizeHeight },
                }),
              ],

              inertia: true,
            })
            .draggable({
              listeners: { move: window.dragMoveListener },
              inertia: true,
              modifiers: [
                interact.modifiers.restrictRect({
                  restriction: "parent",
                  endOnly: true,
                }),
              ],
            });
        }
      }

      function setEvents() {
        let x = 1;

        while (x <= contentData.length) {
          setImageEvent(x);
          setTextEvent(x);
          x++;
        }
      }

      $(document).ready(function () {
        setEvents();
        setTimeout(function () {
          displayImages(index + 1, "block");
          initImageSize(1);
          initTextPosition(1);
        }, 50);

        $(window).on("orientationchange", function (event) {
          if (window.orientation === 90 || window.orientation === -90) {
            $("#content").css("height", `200px`);
          } else {
            $("#content").css("height", `400px`);
          }
          setTimeout(function () {
            resetSlide();
          }, 100);
        });

        $(window).on("mousedown", function (e) {
          let target = e.target;
          if (!target.id) {
            target = $(e.target).parents(".textSlide")[0];
          }
          if (!target.id || (target.id && target.id !== curTargetId)) {
            $(".textSlide").removeClass("shadow");
            $(".slide").removeClass("shadow");
          }
        });
        $(window).on("touchstart", function (e) {
          let target = e.target;
          if (!target.id) {
            target = $(e.target).parents(".textSlide")[0];
          }
          if (!target.id || (target.id && target.id !== curTargetId)) {
            $(".textSlide").removeClass("shadow");
            $(".slide").removeClass("shadow");
          }
        });
      });
    </script>
  </body>
</html>
